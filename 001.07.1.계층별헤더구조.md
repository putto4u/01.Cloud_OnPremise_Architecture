## 🌐 OSI 계층별 헤더 구조 및 설명

OSI(Open Systems Interconnection) 7계층 모델에서 **데이터는 각 계층을 통과하면서 해당 계층의 기능을 수행하기 위한 제어 정보인 헤더(Header)가 추가**되거나(캡슐화, Encapsulation), **제거**됩니다(역캡슐화, Decapsulation).

여기서는 각 주요 계층(4계층까지)에서 데이터에 추가되는 헤더의 일반적인 구조와 그 역할에 대해 설명합니다.

---

### 🖼️ OSI 7계층별 데이터 단위 및 헤더 추가 과정

| 계층 (Layer) | 데이터 단위 (PDU) | 헤더/트레일러 추가 (Encapsulation) | 주요 프로토콜 예시 |
| :---: | :---: | :---: | :---: |
| **7. 응용 (Application)** | Data / 메시지 | N/A (최종 사용자 데이터) | HTTP, FTP, SMTP |
| **6. 표현 (Presentation)** | Data / 메시지 | N/A (데이터 형식, 암호화) | JPEG, ASCII, TLS/SSL |
| **5. 세션 (Session)** | Data / 메시지 | N/A (연결 관리) | NetBIOS, RPC |
| **4. 전송 (Transport)** | **세그먼트 (Segment)** | **TCP/UDP 헤더** | TCP, UDP |
| **3. 네트워크 (Network)** | **패킷 (Packet)** | **IP 헤더** | IP, ICMP |
| **2. 데이터 링크 (Data Link)** | **프레임 (Frame)** | **MAC 헤더 + 트레일러** | Ethernet, PPP |
| **1. 물리 (Physical)** | **비트 (Bit)** | N/A (물리적 전송) | UTP 케이블, 광섬유 |



---

### 1. 전송 계층 (Layer 4) 헤더: TCP/UDP

전송 계층은 **프로세스-대-프로세스 통신**을 담당하며, **세그먼트(Segment)**라는 데이터 단위를 사용합니다.

#### 🔸 TCP (Transmission Control Protocol) 헤더

TCP는 **신뢰성 있는 연결 기반** 통신을 제공하며, UDP에 비해 복잡한 헤더를 가집니다.

| 필드 | 크기 (Bytes) | 주요 역할 |
| :--- | :---: | :--- |
| **Source Port** | 2 | 출발지 프로세스 식별 번호 |
| **Destination Port** | 2 | 목적지 프로세스 식별 번호 |
| Sequence Number | 4 | 세그먼트 순서 번호 (재조립용) |
| Acknowledgment Number | 4 | 수신한 다음 예상 순서 번호 |
| Data Offset (Header Length) | 4 bits | TCP 헤더의 길이 (워드 단위) |
| Reserved | 6 bits | 예약 필드 (사용 안 함) |
| **Flags (Control Bits)** | 6 bits | **SYN, ACK, FIN 등** 연결 제어 플래그 |
| Window Size | 2 | 수신 버퍼 크기 (흐름 제어) |
| Checksum | 2 | 헤더 및 데이터 오류 검출 |
| Urgent Pointer | 2 | 긴급 데이터 위치 표시 |
| Options | Variable | 선택적 기능 필드 |

* **실전 팁**: **Port Number**는 서버에서 실행 중인 특정 서비스(HTTP 80, HTTPS 443, FTP 21 등)를 구별하는 데 필수적입니다. **Flags**는 3-way Handshake(SYN, SYN-ACK, ACK)나 연결 종료(FIN) 같은 연결 관리에 핵심적인 역할을 합니다.



#### 🔹 UDP (User Datagram Protocol) 헤더

UDP는 **비연결형, 신뢰성 없음**의 특징을 가지며, TCP보다 훨씬 간단한 헤더를 사용하여 오버헤드가 적습니다.

| 필드 | 크기 (Bytes) | 주요 역할 |
| :--- | :---: | :--- |
| **Source Port** | 2 | 출발지 프로세스 식별 번호 |
| **Destination Port** | 2 | 목적지 프로세스 식별 번호 |
| **Length** | 2 | UDP 헤더와 데이터의 전체 길이 |
| Checksum | 2 | 헤더 및 데이터 오류 검출 (선택 사항) |

---

### 2. 네트워크 계층 (Layer 3) 헤더: IP

네트워크 계층은 **호스트-대-호스트 통신**을 담당하며, **패킷(Packet)**이라는 데이터 단위를 사용합니다. 여기서 주로 사용되는 것은 **IP(Internet Protocol)** 헤더입니다.

| 필드 | 크기 (Bits) | 주요 역할 |
| :--- | :---: | :--- |
| Version | 4 | IP 프로토콜 버전 (**IPv4: 4, IPv6: 6**) |
| Header Length (IHL) | 4 | IP 헤더의 길이 (4바이트 워드 단위) |
| Type of Service (ToS) / Differentiated Services Field (DS Field) | 8 | 서비스 품질(QoS) 관련 |
| Total Length | 16 | IP 패킷 전체 길이 (헤더 + 데이터) |
| Identification | 16 | 패킷 재조립을 위한 식별자 |
| Flags | 3 | 분할(Fragmentation) 제어 플래그 |
| Fragment Offset | 13 | 분할된 패킷의 위치 정보 |
| Time to Live (**TTL**) | 8 | 패킷이 네트워크에 머무를 수 있는 최대 홉(Hop) 수 |
| Protocol | 8 | 상위 계층(전송 계층) 프로토콜 식별 (**TCP: 6, UDP: 17**) |
| Header Checksum | 16 | IP 헤더 오류 검사 |
| **Source IP Address** | 32 | **출발지 호스트의 논리적 주소** |
| **Destination IP Address** | 32 | **목적지 호스트의 논리적 주소** |
| Options | Variable | 선택적 기능 필드 |

* **강조**: **Source IP Address**와 **Destination IP Address**는 라우터가 패킷을 올바른 네트워크 경로로 전달하는 데 사용되는 핵심 정보입니다. **TTL**은 패킷이 무한 루프에 빠지는 것을 방지합니다.



---

### 3. 데이터 링크 계층 (Layer 2) 헤더: Ethernet

데이터 링크 계층은 **노드-대-노드 통신**을 담당하며, **프레임(Frame)**이라는 데이터 단위를 사용합니다. LAN 환경에서는 주로 **Ethernet** 프로토콜을 사용합니다.

| 필드 | 크기 (Bytes) | 위치 | 주요 역할 |
| :--- | :---: | :---: | :--- |
| Preamble | 7 | N/A | 수신 장치의 동기화 |
| Start of Frame Delimiter (SFD) | 1 | N/A | 프레임 시작 표시 |
| **Destination MAC Address** | 6 | **헤더** | **목적지 NIC의 물리적 주소** |
| **Source MAC Address** | 6 | **헤더** | **출발지 NIC의 물리적 주소** |
| Type / Length | 2 | 헤더 | 상위 계층 프로토콜 식별 (IP, ARP 등) |
| Data | 46-1500 | N/A | L3 패킷 (IP 헤더 + L4 세그먼트) |
| Frame Check Sequence (**FCS**) | 4 | **트레일러** | 전송 오류 검출 (CRC) |

* **자주 오해하거나 실수하는 부분**: Ethernet 프레임은 **헤더**와 **트레일러**를 모두 가집니다. **MAC 주소**는 로컬 네트워크(동일 서브넷) 내에서 통신할 때 사용되며, 네트워크를 넘어갈 때(라우터를 통과할 때)는 계속 변경됩니다. 반면 **IP 주소**는 통신이 끝날 때까지 유지됩니다.
* **실전 팁**: **FCS**는 데이터를 역순으로 확인하는 **트레일러**의 역할로, 오류가 있는지 확인하여 데이터의 무결성을 보장합니다.



[Image of Ethernet Frame structure diagram showing MAC addresses, Type/Length, Data, and FCS]


---

## 💡 요약 및 비교

| 계층 | 데이터 단위 | 핵심 주소 | 주요 기능 |
| :---: | :---: | :---: | :--- |
| **2. 데이터 링크** | 프레임 | **MAC 주소** (물리적) | 로컬 네트워크 내 노드 간 전송, 오류 검출 |
| **3. 네트워크** | 패킷 | **IP 주소** (논리적) | 라우팅, 인터넷 전체 호스트 간 전송 경로 결정 |
| **4. 전송** | 세그먼트 | **Port 번호** (논리적) | 프로세스 간 통신, 신뢰성(TCP) 또는 속도(UDP) 제공 |

다음으로, 특정 계층의 헤더 필드에 대해 더 깊이 있는 분석을 원하십니까? 예를 들어, **TCP 3-way Handshake** 과정에서 **Flags** 필드가 어떻게 사용되는지 자세히 다뤄볼 수 있습니다.
