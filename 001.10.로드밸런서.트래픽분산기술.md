**로드 밸런서(Load Balancer, LB)**를 이용한 트래픽 분산 기술은 **고가용성(HA)** 및 **확장성(Scalability)**을 확보하는 클라우드 및 온프레미스 인프라의 핵심 기술입니다. LB의 원리, 주요 기능, 그리고 트래픽 분산 기법을 체계적으로 설명해 드리겠습니다.

---

## 🚦 1. 로드 밸런서(LB)의 기본 원리 및 역할

로드 밸런서는 클라이언트와 서버팜(Server Farm, 여러 대의 서버 그룹) 사이에 위치하여, 하나의 가상 IP 주소(VIP)로 들어오는 트래픽을 여러 백엔드 서버(Backend Server)들에게 균등하게 분배하는 장치 또는 소프트웨어입니다.

### 핵심 역할

1.  **트래픽 분산 (Load Distribution):** 부하를 여러 서버에 나누어 **개별 서버의 과부하**를 방지하고 전체 시스템 성능을 유지합니다.
2.  **고가용성 (High Availability, HA):** 특정 서버에 장애가 발생하면 LB는 해당 서버로의 트래픽 전송을 중단하고 **정상 서버로만** 트래픽을 전달하여 서비스 중단을 방지합니다.
3.  **확장성 (Scalability):** 서버 증설(Scale-out) 시 LB에 추가만 하면 되므로, 유연한 확장을 가능하게 합니다.

---

## 2. L4 vs. L7 로드 밸런싱

로드 밸런서는 OSI 7 Layer 중 **전송 계층(L4)** 또는 **응용 계층(L7)**에서 작동하며, 이에 따라 트래픽 분산 방식과 기능이 달라집니다.

| 구분 | L4 로드 밸런서 (네트워크/전송 계층) | L7 로드 밸런서 (응용 계층) |
| :--- | :--- | :--- |
| **작동 계층** | L4 (TCP/UDP 헤더) | L7 (HTTP/HTTPS, FTP 등) |
| **분산 기준** | **IP 주소** 및 **포트 번호** | **URL, 쿠키, HTTP 헤더** 등 콘텐츠 기반 |
| **처리 속도** | **빠름** (헤더만 확인) | **느림** (데이터 내용까지 분석) |
| **주요 기능** | 단순 부하 분산, NAT/PAT | **SSL/TLS 암복호화** 종료, **콘텐츠 라우팅**, 웹 방화벽(WAF) 통합 |
| **클라우드 예시** | AWS Network Load Balancer (NLB) | AWS Application Load Balancer (ALB) |

> **실전 팁:** L7 LB는 요청의 내용을 분석하여 특정 URL 요청만 특정 서버 그룹으로 보내는 **콘텐츠 라우팅**이 가능하므로, **마이크로서비스** 아키텍처 환경에 필수적입니다.

---

## 3. 핵심 분산 기법 (Scheduling Algorithms)

LB가 백엔드 서버에 트래픽을 분배하는 방식은 네트워크의 목적과 요구사항에 따라 달라집니다.

| 기법 | 작동 원리 | 특징 및 적합 환경 |
| :--- | :--- | :--- |
| **라운드 로빈 (Round Robin)** | 서버에 순서대로 트래픽을 분배 $(1 \to 2 \to 3 \to 1 \to \dots)$. | 가장 간단하고 공평함. **모든 서버의 성능이 동등**할 때 적합. |
| **가중치 라운드 로빈 (Weighted RR)** | 각 서버에 설정된 **가중치(Weight)**에 비례하여 트래픽을 분배. | 고성능 서버에 더 많은 트래픽을 할당하여 전체 효율을 높임. |
| **최소 연결 (Least Connection)** | **현재 활성 연결(Active Connection)** 수가 가장 적은 서버로 트래픽을 분배. | **세션 길이가 불규칙**한 환경(DB 연결, 채팅 서비스)에서 서버 부하를 균등하게 유지. |
| **최소 응답 시간 (Least Response Time)** | 서버의 연결 수와 **응답 속도**를 모두 고려하여 가장 빠른 서버로 분배. | 서버의 실시간 상태를 반영하여 성능을 극대화. |

---

## 4. 고가용성 확보 기술

로드 밸런서는 서버뿐만 아니라 그 자체의 고가용성도 중요합니다.

### 4.1. 헬스 체크 (Health Check)

LB가 백엔드 서버에 주기적으로 신호를 보내 서버의 **정상 작동 여부**를 확인하는 기능입니다.

* **실패 시 처리:** 헬스 체크에 실패한 서버는 **장애 서버(Down)**로 간주하고 트래픽 분배 대상에서 즉시 제외됩니다. 서버가 다시 정상 상태로 복구되면 자동으로 분배 대상에 포함됩니다.

### 4.2. 세션 지속성 (Session Persistence / Session Stickiness)

웹 서비스에서 사용자 세션 정보(로그인 상태, 장바구니 등)는 특정 서버에 저장되는 경우가 많습니다.

* **역할:** 사용자 한 명의 요청이 **항상 동일한 백엔드 서버**로 전달되도록 유지하여, 세션 정보 손실 없이 서비스 연속성을 보장합니다. **쿠키**나 **소스 IP 주소**를 기준으로 유지합니다.

### 4.3. 로드 밸런서 자체 이중화 (HA)

온프레미스에서는 두 대의 LB를 **액티브-스탠바이** 또는 **액티브-액티브**로 구성하여 LB 자체의 장애를 방지합니다. 클라우드 환경에서는 LB가 자동으로 여러 **가용 영역(AZ)**에 분산되어 이중화됩니다.
