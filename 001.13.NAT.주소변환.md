##  NAT (Network Address Translation) 주소 변환

NAT는 **IP 패킷의 주소(Source/Destination IP)를 변환하여 라우터를 통해 트래픽을 주고받게 하는 핵심 네트워크 기술**입니다. 주로 **사설 IP 주소**를 **공인 IP 주소**로 바꾸는 데 사용되며, 현대 인터넷 환경에서 **IPv4 주소 고갈 문제**를 완화하고 **네트워크 보안을 강화**하는 데 결정적인 역할을 합니다.

---

### 1.  NAT의 정의와 사용 목적

#### 1️⃣ 정의

* **NAT (Network Address Translation):** 네트워크 주소 변환. 라우터나 방화벽 등의 장비에서 패킷의 **출발지 또는 목적지 IP 주소와 포트 번호**를 변경하는 기술입니다.
    * IP 헤더가 변경되므로, 패킷의 무결성을 검증하는 **체크섬(Checksum)**도 다시 계산하여 재기록해야 합니다.

#### 2️⃣ 주요 사용 목적 (왜 필요한가?)

* **IPv4 주소 고갈 문제 완화:**
    * 내부 사설 네트워크에서 **사설 IP 주소**를 자유롭게 사용하고, 인터넷으로 나갈 때만 소수의 **공인 IP 주소**로 변환하여 공유합니다. 이는 공인 IP 주소의 효율적인 사용을 가능하게 합니다.
* **보안 강화 (내부 네트워크 은폐):**
    * 외부 네트워크에는 내부 장치의 **실제 사설 IP 주소**가 노출되지 않고, NAT 장비의 공인 IP 주소만 보이게 됩니다. 이로 인해 해커가 내부 네트워크 구조를 파악하고 직접적인 공격을 시도하기 어렵게 만듭니다.
* **네트워크 관리 유연성:**
    * 내부 네트워크의 IP 주소 체계를 변경하더라도, 외부에 노출되는 공인 IP 주소는 그대로 유지할 수 있어 관리의 복잡성을 줄여줍니다.

---

### 2.  NAT의 동작 원리 (변환 과정)

NAT는 라우터 내부에 **NAT 테이블(Session Table)**을 생성하고 관리하며 주소 변환을 수행합니다.

1.  **내부에서 외부로 통신 (Outbound Traffic):**
    * **클라이언트(사설 IP: $192.168.1.10$)**가 외부에 패킷을 전송합니다.
    * 라우터(NAT 장비)는 패킷을 가로채어 출발지 IP 주소($192.168.1.10$)를 라우터의 **공인 IP 주소($203.0.113.5$)**로 변경합니다.
    * 라우터는 이 변환 정보를 NAT 테이블에 기록합니다. (예: $192.168.1.10$ $\rightarrow$ $203.0.113.5$)
    * 패킷은 공인 IP를 달고 외부 인터넷으로 나갑니다.
2.  **외부에서 내부로 응답 (Inbound Traffic):**
    * 외부 서버는 라우터의 공인 IP 주소($203.0.113.5$)로 응답 패킷을 보냅니다.
    * 라우터는 응답 패킷을 수신하고 NAT 테이블을 확인합니다.
    * 테이블의 기록을 바탕으로 목적지 IP 주소($203.0.113.5$)를 원래의 클라이언트 사설 IP 주소($192.168.1.10$)로 **역변환**합니다.
    * 패킷은 최종적으로 내부 클라이언트에게 전달됩니다.

---

### 3.  NAT의 세 가지 주요 유형

NAT는 주소 변환 방식과 비율에 따라 크게 세 가지로 구분됩니다.

#### 1️⃣ 정적 NAT (Static NAT, SNAT)

| 특징 | 설명 | 용도 |
| :--- | :--- | :--- |
| **변환 비율** | **1:1 매핑** (내부 사설 IP 하나 $\rightarrow$ 공인 IP 하나) | 내부의 **특정 서버(웹 서버, FTP 서버 등)**를 외부에서 항상 동일한 공인 IP로 접근 가능하게 할 때 사용됩니다. |
| **변환 시점** | 고정적 (주소 변환 테이블에 고정 항목) |

#### 2️⃣ 동적 NAT (Dynamic NAT)

| 특징 | 설명 | 용도 |
| :--- | :--- | :--- |
| **변환 비율** | **1:1 매핑** (내부 사설 IP 하나 $\rightarrow$ 공인 IP 풀 중 하나) | **사용 가능한 공인 IP 풀**이 있으며, 내부 장치가 통신을 시작할 때 풀에서 동적으로 공인 IP를 할당받습니다. 정해진 순서 없이 유동적입니다. |
| **변환 시점** | 동적 (연결 요청 시 할당) |

#### 3️⃣ PAT (Port Address Translation) / NAT 오버로드

| 특징 | 설명 | 용도 |
| :--- | :--- | :--- |
| **변환 비율** | **N:1 매핑** (다수의 사설 IP $\rightarrow$ **단일 공인 IP**) | **가장 일반적으로 사용**되는 방식입니다. 하나의 공인 IP 주소에 **포트 번호**를 추가하여 여러 내부 장치의 연결을 구분합니다. |
| **변환 시점** | 동적 (포트 번호 사용) |
| **강조점** | IP 주소뿐만 아니라 **포트 번호까지 함께 변환/관리**하여 구별합니다.

---

### ⚠️ 자주 오해하거나 실수하는 부분 및 실전 팁

* **End-to-End 통신 투명성 문제:** NAT를 거치면서 패킷의 출발지 IP 주소가 변경되기 때문에, 종단 간(End-to-End)의 투명성(Traceability)이 깨지고 특정 애플리케이션 프로토콜(예: 일부 VoIP, IPSec)에서 호환성 문제가 발생할 수 있습니다.
* **Double NAT (이중 NAT):** 라우터 뒤에 또 다른 라우터(공유기)를 연결하여 NAT를 두 번 수행하는 경우입니다. 이는 네트워크 설정의 복잡도를 높이고, 특히 온라인 게임이나 특정 서비스 이용 시 **포트 포워딩** 설정에 문제가 생길 수 있습니다.

NAT의 동작 원리와 유형을 이해하는 것은 네트워크 보안 및 관리 측면에서 매우 중요합니다.

