

# ACL (Access Control List) 완벽 가이드

## Part 1. ACL 개요 및 작동 원리

### 1. ACL이란 무엇인가?

ACL(Access Control List)은 라우터나 스위치와 같은 네트워크 장비 통과하는 패킷을 식별하고, 미리 정의된 정책에 따라 **허용(Permit)**하거나 **거부(Deny)**하는 필터링 기술이다.

* **주요 목적:** 보안 강화(비인가 접근 차단), 트래픽 흐름 제어, 네트워크 대역폭 확보.
* **OSI 계층:** 주로 **L3(IP 주소)** 및 **L4(TCP/UDP 포트)** 정보를 기반으로 동작한다.

### 2. 핵심 작동 원리 (The 3 Rules)

ACL은 매우 엄격한 논리적 순서에 따라 패킷을 처리한다.

1. **Top-Down Processing (순차 처리):**
* ACL은 맨 윗줄부터 아랫줄로 **순서대로** 패킷을 검사한다.


2. **First Match Wins (최초 일치 승리):**
* 패킷의 정보가 특정 줄의 조건과 일치하면, 즉시 해당 동작(Permit/Deny)을 수행하고 **검사를 중단**한다.
* 그 아래에 있는 규칙들은 절대 실행되지 않는다.


3. **Implicit Deny All (암묵적 거부):**
* ACL의 맨 마지막 줄에는 눈에 보이지 않는 **"나머지 모든 트래픽을 차단하라(`deny ip any any`)"**는 규칙이 숨겨져 있다.
* 따라서, 허용할 트래픽을 명시하지 않으면 통신은 두절된다.



---

## Part 2. 와일드카드 마스크 (Wildcard Mask)

ACL 설정의 선행 필수 지식으로, 서브넷 마스크와 반대되는 개념이다.

* **0 (Zero):** 반드시 일치해야 함 (Match)
* **1 (One):** 무시함 / 상관없음 (Ignore)

| 대상 | 표기법 (IP) | 와일드카드 마스크 | 키워드 대체 |
| --- | --- | --- | --- |
| **특정 호스트** | 192.168.1.1 | 0.0.0.0 | **host** 192.168.1.1 |
| **전체 네트워크** | 0.0.0.0 | 255.255.255.255 | **any** |
| **C클래스 대역** | 192.168.1.0 | 0.0.0.255 | - |
| **짝수/홀수 제어** | (심화) | 0.0.0.254 | - |

---

## Part 3. ACL의 종류와 적용 위치 가이드

### 1. Standard ACL (표준 ACL)

* **특징:** 오직 패킷의 **출발지 IP 주소(Source IP)**만 검사한다.
* **번호 범위:** 1 ~ 99 (1300 ~ 1999)
* **적용 위치 원칙:** **목적지(Destination)에 최대한 가깝게** 배치한다.
* *이유:* 출발지 근처에 두면, 해당 출발지에서 나가는 모든 트래픽(다른 정상적인 목적지로 가는 것 포함)이 원천 봉쇄될 위험이 있기 때문이다.



### 2. Extended ACL (확장 ACL)

* **특징:** **출발지 IP, 목적지 IP, 프로토콜(TCP/UDP/ICMP), 포트 번호** 등 다양한 헤더 정보를 정밀하게 검사한다.
* **번호 범위:** 100 ~ 199 (2000 ~ 2699)
* **적용 위치 원칙:** **출발지(Source)에 최대한 가깝게** 배치한다.
* *이유:* 불필요한 트래픽이 네트워크를 타고 목적지까지 이동하여 대역폭을 낭비하기 전에, 소스 근처에서 미리 차단하는 것이 효율적이다.



---

## Part 4. 구성 형식과 문법 (Syntax)

### 1. 키워드 및 연산자

* **host:** 단일 IP 지정 (예: `host 10.1.1.1` = `10.1.1.1 0.0.0.0`)
* **any:** 모든 IP 지정 (예: `any` = `0.0.0.0 255.255.255.255`)
* **eq (Equal):** 특정 포트와 같음 (예: `eq 80`)
* **range:** 포트 범위 지정 (예: `range 20 21`)
* **lt (Less than) / gt (Greater than):** 특정 번호 미만/초과

### 2. Standard ACL 문법

```bash
access-list [번호] [permit/deny] [출발지IP] [와일드카드]

```

> **예시:** `access-list 10 deny 192.168.1.10 0.0.0.0`

### 3. Extended ACL 문법

```bash
access-list [번호] [permit/deny] [프로토콜] [출발지] [목적지] [옵션:포트]

```

> **예시:** `access-list 100 permit tcp 192.168.1.0 0.0.0.255 host 10.1.1.1 eq 80`

### 4. Named ACL (이름 기반)

번호 대신 직관적인 이름을 사용하며, 줄 단위 편집이 용이하다.

```bash
ip access-list [standard/extended] [이름]
 [Sequence번호] [permit/deny] ...

```

---

## Part 5. 우선순위: 번호(ID) vs 시퀀스(Sequence)

많은 엔지니어가 혼동하는 부분이다. 명확한 구분이 필요하다.

### 1. ACL 식별 번호 (ID)

* `access-list 10`과 `access-list 100` 중 누가 우선인가?
* **답변:** 우선순위와 전혀 관계없다. 10은 Standard, 100은 Extended라는 **타입(Type)**을 나타낼 뿐이다.

### 2. 시퀀스 넘버 (Sequence Number)

* **실제 우선순위**를 결정한다. 하나의 ACL 묶음 안에서 **숫자가 낮을수록 먼저 검사**된다.
* 기본적으로 10단위로 자동 생성된다 (10, 20, 30...).
* **중간 삽입:** 10번과 20번 사이에 규칙을 넣고 싶으면 시퀀스 15번으로 생성하면 된다.

```bash
! 시퀀스 확인 및 편집 예시
Switch# show ip access-lists MySecPolicy
Extended IP access list MySecPolicy
    10 deny tcp any host 10.1.1.1 eq 23   <-- 가장 먼저 처리됨
    20 permit ip any any                  <-- 나중에 처리됨

```

---

## Part 6. 인터페이스 적용 (Activation)

ACL을 아무리 잘 만들어도 인터페이스에 적용하지 않으면 무용지물이다.

### 1. 적용 명령어

```bash
interface GigabitEthernet 0/1
 ip access-group [번호/이름] [in / out]

```

### 2. Inbound(in) vs Outbound(out) 구분

라우터/스위치 **"중심"**으로 생각해야 한다.

* **In (입력):** 패킷이 케이블을 타고 장비 **안으로 들어올 때** 검사. (라우팅 처리 전)
* **Out (출력):** 장비가 라우팅 처리를 끝내고 밖으로 **내보낼 때** 검사.

---

## Part 7. 심화: Object Groups & 하드웨어 가속

### 1. Object Groups (객체 그룹)

방화벽처럼 다수의 IP나 포트를 하나의 그룹으로 묶어 ACL 가독성을 높이고 설정을 간소화한다.

```bash
! 1. 객체 생성
object-group network ADMIN_IPS
 192.168.10.1 255.255.255.255
 192.168.10.2 255.255.255.255

! 2. ACL에서 호출
access-list 100 permit ip object-group ADMIN_IPS any

```

### 2. ACL 전용 장비 vs 스위치/라우터 ACL

* **라우터/스위치 (TCAM):**
* 하드웨어(TCAM)에서 처리하므로 ACL 줄 수가 많아도 속도 저하가 거의 없다(Wire-speed).
* Stateless(상태 비저장) 방식이 기본이다. (단순 패킷 헤더 비교)


* **전문 방화벽 (Stateful Inspection):**
* 세션의 상태(연결 요청, 확립, 종료)를 추적한다.
* 나가는 패킷이 허용되면 들어오는 응답 패킷은 자동으로 허용된다(스위치 ACL은 양방향 다 열어줘야 함).



---

## Part 8. 실전 실습 문제 (Lab Scenarios)

### [Scenario 1] Standard ACL

* **상황:** 사내 보안을 위해 영업팀 PC(192.168.1.100)가 임원실 네트워크(192.168.2.0/24)에 접근하는 것을 막아야 한다. 나머지는 모두 허용한다.
* **조건:** Standard ACL 사용, 번호 10번 사용.

**[모범 답안]**

```bash
! 1. 정책 생성 (표준 ACL이므로 Destination인 임원실 라우터/스위치에서 설정 권장)
Router(config)# access-list 10 deny host 192.168.1.100
Router(config)# access-list 10 permit any

! 2. 인터페이스 적용 (임원실 게이트웨이 인터페이스의 Outbound)
Router(config)# interface g0/1
Router(config-if)# ip access-group 10 out

```

### [Scenario 2] Extended ACL & Sequence

* **상황:** 외부(Any)에서 내부 웹서버(203.0.113.5)로의 접속은 허용하되, FTP 접속은 차단하고 싶다. 또한 핑(ICMP) 테스트도 허용해야 한다.
* **조건:** Named ACL "DMZ_Rule" 사용.

**[모범 답안]**

```bash
! 1. 정책 생성
Router(config)# ip access-list extended DMZ_Rule
Router(config-ext-nacl)# 10 permit tcp any host 203.0.113.5 eq 80
Router(config-ext-nacl)# 20 permit tcp any host 203.0.113.5 eq 443
Router(config-ext-nacl)# 30 deny tcp any host 203.0.113.5 range 20 21
Router(config-ext-nacl)# 40 permit icmp any host 203.0.113.5
Router(config-ext-nacl)# 50 deny ip any any  (생략 가능하나 명시 권장)

! 2. 인터페이스 적용 (외부망 연결 인터페이스 Inbound)
Router(config)# interface g0/0
Router(config-if)# ip access-group DMZ_Rule in

```

---

## Part 9. 놓치기 쉬운 팁 (Instructor's Note)

1. **Log 키워드 활용:**
* `permit tcp any any eq 80 log` 처럼 끝에 `log`를 붙이면, 해당 규칙에 매칭될 때마다 콘솔에 로그를 남긴다. 트러블슈팅 시 매우 유용하다 (단, CPU 부하 주의).


2. **Established 옵션:**
* `permit tcp any any established`를 사용하면, 내부에서 시작된 세션의 응답 패킷(ACK/RST 비트 설정됨)만 받아들인다. 일종의 간이 상태 기반 필터링 효과를 낼 수 있다.


3. **수정 시 주의:**
* 번호 기반 ACL은 `no access-list 10` 하는 순간 **리스트 전체가 삭제**된다. 한 줄만 지우고 싶다면 반드시 Named ACL 모드로 진입하거나, 메모장에 복사해서 수정 후 덮어써야 한다.



**Next Level :** Reflexive ACL(재귀적 ACL) 설정법과 Zone-Based Firewall의 개념 소개
